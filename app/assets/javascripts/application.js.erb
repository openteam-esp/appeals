/* This is a manifest file that'll be compiled into including all the files listed below.
 * Add new JavaScript/Coffee code in separate files in this directory and they'll automatically
 * be included in the compiled file accessible from http://example.com/assets/application.js
 * It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
 * the compiled file.
 *
 *= require jquery
 *= require jquery-ui
 *= require jquery.ui.datepicker-ru
 *= require jquery.iframe.transport
 *= require jquery.fileupload
 *= require jquery_ujs
 */

function init_datepicker() {

  if ($.fn.datepicker) {
    $("input.datepicker").datepicker({
      changeMonth: true,
      changeYear: true,
      showOn: "button",
      buttonText: '',
      buttonImage: "<%= image_path("ui/calendar.png") %>",
      buttonImageOnly: true
    });
  };

};

function uploads_manage() {
  if ($.fn.fileupload) {
    $("#appeal_file").fileupload({
      url: "/public/uploads",
      dataType: "html",
      start: function(e) {
        //upload_link.addClass("ajax_loading");
      },
      stop: function(e) {
        //upload_link.removeClass("ajax_loading");
      },
      add: function(e, data) {
        data.submit()
        .success(function (result, textStatus, jqXHR) {
        })
        .error(function (jqXHR, textStatus, errorThrown) {
          alert(errorThrown + "\n\n" + jqXHR.responseText);
        });
      }
    });
  };
};

$(function() {

  init_datepicker();

  uploads_manage();

  $(".focus_first:first").focus();

  $('.disable').live('click', function(){
    return false;
  });

  $('.reply_wrapper')
    .bind('ajax:success', function(evt, data, status, xhr){
      $('.reply_wrapper').html(xhr.responseText);
      $('.close').addClass('disable');
      init_datepicker();
    })
    .bind('ajax:complete', function(evt, xhr, status){
      $('.reply_wrapper').html(xhr.responseText);
      if ($('.reply_wrapper .reply_info:first').attr('can_close') == 'true') {
        $('.close').removeClass('disable') ;
      } else {
        $('.close').addClass('disable');
      };
    });

});
